plugins { id 'java' }

ext.ghidraInstall = System.getenv('GHIDRA_INSTALL_DIR')
if (!ghidraInstall) {
    throw new GradleException('Set GHIDRA_INSTALL_DIR env var')
}

sourceCompatibility = '17'
targetCompatibility = '17'

repositories { mavenCentral() }

dependencies {
    // All Ghidra framework JARs for compile/runtime
    implementation fileTree(dir: "${ghidraInstall}/Ghidra/Framework", include: "**/*.jar")
    // JNA (already bundled with Ghidra, but add explicitly for IDE autoâ€‘completion)
    implementation "net.java.dev.jna:jna:5.14.0"
}

tasks.register('buildExtension') {
    dependsOn 'classes'
    doLast {
        ant.zip(destfile: "${buildDir}/dist/DwarfForge.zip",
                basedir : 'build/classes/java/main',
                includes: "**/*.class,**/*.png,**/*.manifest")
    }
}
